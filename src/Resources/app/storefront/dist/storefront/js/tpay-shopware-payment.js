(window.webpackJsonp=window.webpackJsonp||[]).push([["tpay-shopware-payment"],{QnJ5:function(t,e,n){"use strict";n.r(e);var i=n("FGIj"),o=n("ERap"),r=n("gHbT");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d,p,f,h=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,c(e).apply(this,arguments))}var n,i,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this._banks=r.a.querySelectorAll(this.el,this.options.bankLabelSelector),this._paymentInputPaymentInput=r.a.querySelector(document,'[name="'.concat(this.options.paymentMethodInputName,'"][value="').concat(this.options.paymentId,'"]')),this._registerEvents()}},{key:"_registerEvents",value:function(){var t=this;o.a.iterate(this._banks,(function(e){e.addEventListener("click",t._onBankClick.bind(t))}))}},{key:"_onBankClick",value:function(t){var e=this.el.querySelector("."+this.options.itemActiveClass);t.stopPropagation(),this._paymentInputPaymentInput.checked=!0,e&&e.classList.remove(this.options.itemActiveClass),t.target.parentElement.classList.add(this.options.itemActiveClass)}}])&&s(n.prototype,i),a&&s(n,a),e}(i.a);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function v(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}f={bankInputName:"tpayBank",bankLabelSelector:".tpay--list-item-container",paymentMethodInputName:"paymentMethodId",itemActiveClass:"is--active",paymentId:""},(p="options")in(d=h)?Object.defineProperty(d,p,{value:f,enumerable:!0,configurable:!0,writable:!0}):d[p]=f;var _=[new RegExp("^[0-9]$"),new RegExp("^[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$")],g=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,m(e).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this.validateBlik(),this._registerEvents()}},{key:"_registerEvents",value:function(){this.el.addEventListener("keyup",this.validateBlik.bind(this))}},{key:"validateBlik",value:function(){var t,e,n,i=" "===this.el.value[3],o=this.el.value.length;if(o<0&&(this.el.value=""),o<=7&&o>0){if(o>=4&&!i)return this.el.value=(t=this.el.value,e=" ",n=3,"".concat(t.slice(0,n)).concat(e).concat(t.slice(n))),void this.validateBlik();for(;o>0&&!_[o-1].test(this.el.value);)this.el.value=this.el.value.slice(0,-1),o=this.el.value.length}else o>=8&&o<=9&&(this.el.value=this.el.value.slice(0,-1));this.el.value.length>=8&&(this.el.value=this.el.value.slice(0,7-this.el.value.length))}}])&&y(n.prototype,i),o&&y(n,o),e}(i.a),w=n("Cxgn"),S=n("p4AR");function C(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var O=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._httpClient=new S.a}var e,n,i;return e=t,(n=[{key:"sendBlikTransaction",value:function(t,e){this._httpClient.post(window.router["sales-channel-api.tpay.blik-paymen.register-transaction"],t,e)}},{key:"sendBlikTransactionAgain",value:function(t,e){this._httpClient.post(window.router["sales-channel-api.tpay.blik-paymen.register-transaction-again"],t,e)}},{key:"checkPaymentState",value:function(t,e){this._httpClient.post(window.router["sales-channel-api.tpay.blik-paymen.check-payment-state"],JSON.stringify({orderId:t}),e)}}])&&C(e.prototype,n),i&&C(e,i),t}();function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function P(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,$(e).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(e,t),n=e,(i=[{key:"_open",value:function(t){this.getModal(),this._$modal.on("hidden.bs.modal",this._modalWrapper.remove),this._$modal.on("shown.bs.modal",t),this._$modal.modal({backdrop:"static",keyboard:!1}),this._$modal.modal("show")}}])&&E(n.prototype,i),o&&E(n,o),e}(n("2Jwc").a);function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function M(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var A=new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$"),x=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),M(this,q(e).apply(this,arguments))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this.$blikButtonSubmit=this.el.querySelector(this.options.submitButtonSelector),this.$allRequiredTosPositions=document.querySelectorAll(this.options.tos.tosContainerSelector+' [required="required"]'),this.$blikCodeInput=this.el.querySelector(this.options.blikCodeInputSelector),this.$blikModal=document.querySelector(".blik--modal"),this._errors=[],this._blikApiClient=new O,this._registerEvents()}},{key:"_registerEvents",value:function(){var t=this;this.el.addEventListener("submit",this._onSubmitForm.bind(this)),this.$blikButtonSubmit.addEventListener("click",this._sendBlik.bind(this)),o.a.iterate(this.$allRequiredTosPositions,(function(e){e.addEventListener("change",(function(){e.checked?e.classList.remove(t.options.isInvalidClass):e.classList.add(t.options.isInvalidClass)})),e.addEventListener("invalid",(function(t){t.target.scrollIntoView({behavior:"smooth",block:"center"})}))}))}},{key:"_onSubmitForm",value:function(t){t.preventDefault()}},{key:"_sendBlik",value:function(){if(this._tosValidation()){var t=new T(this.$blikModal.outerHTML);t.open(this._onOpenBlik.bind(this)),this.$blikModal=t.getModal(),this._blikCodeValidation()?this._blikApiClient.sendBlikTransaction(new FormData(this.el),this._handleBlikTransaction.bind(this)):(this.$blikCodeInput.classList.add(this.options.isInvalidClass),this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass)),this.$blikModal.classList.add(this.options.pseudoModalAdditionalClass),this.$blikModal.querySelector(".modal-dialog").classList.add("modal-dialog-centered"),this.$blikModal.querySelector(this.options.modalChangeMethodButtonSelector).addEventListener("click",(function(){t.close()}))}}},{key:"_onOpenBlik",value:function(){this._registerModalEvents(this.$blikModal),w.a.initializePlugins()}},{key:"_registerModalEvents",value:function(t){var e=this,n=t.querySelector(this.options.blikCodeInputSelector);t.querySelector(this.options.submitButtonSelector).addEventListener("click",(function(){var i=t.querySelector(e.options.modalInvalidCodeSelector);if(e._blikCodeValidation(n)){n.classList.remove(e.options.isInvalidClass),e.$blikModal.querySelector(".blik--modal").classList.remove(e.options.isInvalidClass);var o=new FormData(e.el);o.set("blikCode",n.value),e._notPaidOrderId?(o.append("orderId",e._notPaidOrderId),o.append("paymentMethodId",e.options.paymentMethodId),e._blikApiClient.sendBlikTransactionAgain(o,e._handleBlikTransaction.bind(e))):e._blikApiClient.sendBlikTransaction(o,e._handleBlikTransaction.bind(e))}else n.classList.add(e.options.isInvalidClass),i.classList.add(e.options.isInvalidClass)}))}},{key:"_handleBlikTransaction",value:function(t){var e=this,n=JSON.parse(t);if(!this._handleErrors(n))return!1;n.success&&n.orderId&&(this._finishUrl=n.finishUrl,this._orderId=n.orderId,setTimeout((function(){e._blikApiClient.checkPaymentState(n.orderId,e._handleCheckPaymentState.bind(e))}),500))}},{key:"_handleCheckPaymentState",value:function(t){var e=this,n=JSON.parse(t);if(!this._handleErrors(n))return!1;n.waiting?setTimeout((function(){e._blikApiClient.checkPaymentState(e._orderId,e._handleCheckPaymentState.bind(e))}),500):n.success&&(this.$blikModal.classList.add("is--success"),this.$blikModal.querySelector(".blik--modal-message-success").classList.remove("is--hidden"),this.$blikModal.querySelector(".blik--modal-message-wait").classList.add("is--hidden"),setTimeout((function(){window.location.replace(e._finishUrl)}),5e3))}},{key:"_handleErrors",value:function(t){return!(!t.waiting&&(void 0!==t.error&&t.error.length>0?(this._errors+=t.error,1):!t.success&&!t.blikCodeValid&&(this._notPaidOrderId=t.orderId,this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass,"is-blik-invalid"),1)))}},{key:"_tosValidation",value:function(){var t=this;if(0===this.$allRequiredTosPositions.length)return!0;o.a.iterate(this.$allRequiredTosPositions,(function(e){e.checked?e.classList.remove(t.options.isInvalidClass):e.classList.add(t.options.isInvalidClass)}));var e=[];return[].forEach.call(this.$allRequiredTosPositions,(function(n){n.classList.contains(t.options.isInvalidClass)&&e.push(!0)})),0===e.length}},{key:"_blikCodeValidation",value:function(t){return void 0===t&&(t=this.$blikCodeInput),0===t.value.length?(t.classList.add(this.options.isInvalidClass),!1):A.test(t.value)}}])&&B(n.prototype,i),r&&B(n,r),e}(i.a);!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(x,"options",{paymentMethodId:"",blikTransactionUrl:"",blikCheckStatusUrl:"",submitButtonSelector:"#confirmFormSubmit",blikCodeInputSelector:".blik--input",pseudoModalAdditionalClass:"blik-modal",modalChangeMethodButtonSelector:".blik--modal-change-method-btn",modalInvalidCodeSelector:".blik--modal-invalid-code",modalWaitCodeSelector:".blik--modal-wait-state",modalErrorSelector:".blik--modal-error-state",modalSuccessSelector:".blik--modal-success-state",isInvalidClass:"is-invalid",tos:{tosContainerSelector:".confirm-tos"}});var J=window.PluginManager;J.register("TpayPaymentBankSelection",h,"[data-tpay-bank-selection]"),J.register("TpayBlikMask",g,".blik--input"),J.register("TpayBlik",x,"[data-tpay-blik")}},[["QnJ5","runtime","vendor-node","vendor-shared"]]]);